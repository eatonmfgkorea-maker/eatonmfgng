<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ë¶ˆëŸ‰ ê³µì§€ ì‹œìŠ¤í…œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    body{background:#0F172A;font-family:'Noto Sans KR',sans-serif;-webkit-text-size-adjust:100%}
    input,select,textarea,button{font-size:16px!important;font-family:'Noto Sans KR',sans-serif}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#F97316!important}
    input::placeholder,textarea::placeholder{color:#64748B}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;
const API_URL='https://script.google.com/macros/s/AKfycbyo_Cw5yJ42L-7ZQVTfdNstZrzi5JDyb_ZHyCjN3kxfQQwd593FqsoxV3y8SunS7GrN/exec';

const App=()=>{
  const[activeTab,setActiveTab]=useState('input');
  const[records,setRecords]=useState([]);
  const[settings,setSettings]=useState({tcpLines:['TCP Line 1','TCP Line 2'],feLines:['FE Line 1','FE Line 2'],tcpRecipients:'',feRecipients:''});
  const[newTcpLine,setNewTcpLine]=useState('');
  const[newFeLine,setNewFeLine]=useState('');
  const[selectedImage,setSelectedImage]=useState(null);
  const[showPreviewModal,setShowPreviewModal]=useState(false);
  const[isSending,setIsSending]=useState(false);
  const fileInputRef=useRef(null);
  const[formData,setFormData]=useState({division:'',type:'',reporter:'',title:'',date:new Date().toISOString().split('T')[0],shift:'ì£¼ê°„',line:'',process:'',productName:'',startTime:'',endTime:'',problem:'',action:'',note:'',recurrence:'ìµœì´ˆ',recurrenceNote:'',photos:[]});

  useEffect(()=>{
    const r=localStorage.getItem('defectRecords');
    const s=localStorage.getItem('defectSettings');
    if(r)setRecords(JSON.parse(r));
    if(s){const p=JSON.parse(s);if(p.lines&&!p.tcpLines){p.tcpLines=p.lines;p.feLines=p.lines;delete p.lines}setSettings(prev=>({...prev,...p}))}
  },[]);
  useEffect(()=>{localStorage.setItem('defectRecords',JSON.stringify(records))},[records]);
  useEffect(()=>{localStorage.setItem('defectSettings',JSON.stringify(settings))},[settings]);

  const handleInputChange=(f,v)=>{setFormData(prev=>{const n={...prev,[f]:v};if(f==='division')n.line='';return n})};
  const handleReporterChange=(v)=>{const k=v.replace(/[^ê°€-í£ã„±-ã…ã…-ã…£]/g,'').slice(0,4);setFormData(prev=>({...prev,reporter:k}))};
  const handlePhotoUpload=(e)=>{Array.from(e.target.files).forEach(f=>{const r=new FileReader();r.onload=(ev)=>{setFormData(prev=>({...prev,photos:[...prev.photos,{id:Date.now()+Math.random(),data:ev.target.result,name:f.name}]}))};r.readAsDataURL(f)});e.target.value=''};
  const removePhoto=(id)=>{setFormData(prev=>({...prev,photos:prev.photos.filter(p=>p.id!==id)}))};
  const handlePreviewClick=()=>{if(!formData.division||!formData.type||!formData.reporter||!formData.title||!formData.line||!formData.process||!formData.productName){alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return}setShowPreviewModal(true)};
  
  const handleConfirmSend=async()=>{
    setIsSending(true);
    try{
      const payload={...formData,tcpRecipients:settings.tcpRecipients,feRecipients:settings.feRecipients};
      const form=document.createElement('form');
      form.method='POST';
      form.action=API_URL;
      form.target='hidden_iframe';
      const input=document.createElement('input');
      input.type='hidden';
      input.name='data';
      input.value=JSON.stringify(payload);
      form.appendChild(input);
      let iframe=document.getElementById('hidden_iframe');
      if(!iframe){iframe=document.createElement('iframe');iframe.name='hidden_iframe';iframe.id='hidden_iframe';iframe.style.display='none';document.body.appendChild(iframe)}
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
      setRecords(prev=>[{...formData,id:Date.now(),createdAt:new Date().toISOString()},...prev]);
      setFormData({division:'',type:'',reporter:'',title:'',date:new Date().toISOString().split('T')[0],shift:'ì£¼ê°„',line:'',process:'',productName:'',startTime:'',endTime:'',problem:'',action:'',note:'',recurrence:'ìµœì´ˆ',recurrenceNote:'',photos:[]});
      setShowPreviewModal(false);
      setActiveTab('input');
      alert('ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    }catch(e){console.error(e);alert('ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')}finally{setIsSending(false)}
  };

  const addTcpLine=()=>{if(newTcpLine.trim()&&!settings.tcpLines.includes(newTcpLine.trim())){setSettings(p=>({...p,tcpLines:[...p.tcpLines,newTcpLine.trim()]}));setNewTcpLine('')}};
  const removeTcpLine=(l)=>{setSettings(p=>({...p,tcpLines:p.tcpLines.filter(x=>x!==l)}))};
  const addFeLine=()=>{if(newFeLine.trim()&&!settings.feLines.includes(newFeLine.trim())){setSettings(p=>({...p,feLines:[...p.feLines,newFeLine.trim()]}));setNewFeLine('')}};
  const removeFeLine=(l)=>{setSettings(p=>({...p,feLines:p.feLines.filter(x=>x!==l)}))};
  const deleteRecord=(id)=>{if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))setRecords(p=>p.filter(r=>r.id!==id))};
  const handleSettingsChange=(f,v)=>{setSettings(p=>({...p,[f]:v}))};
  const getCurrentLines=()=>formData.division==='TCP'?settings.tcpLines||[]:formData.division==='FE'?settings.feLines||[]:[];
  const getEmailSubject=()=>'[í’ˆì§ˆê²°í•¨] - '+formData.line+' - '+formData.process+' - '+formData.title;
  const getDownTimeText=()=>!formData.startTime?'-':formData.endTime?formData.startTime+' -> '+formData.endTime:formData.startTime+' (ì§„í–‰ì¤‘)';
  const getRecurrenceText=()=>formData.recurrenceNote?formData.recurrence+' - '+formData.recurrenceNote:formData.recurrence;

  const typeColors={'ì„¤ë¹„':{bg:'#FEF3C7',text:'#92400E',border:'#F59E0B'},'ë‹¨í’ˆí’ˆì§ˆ':{bg:'#DBEAFE',text:'#1E40AF',border:'#3B82F6'},'ìì¬':{bg:'#D1FAE5',text:'#065F46',border:'#10B981'}};
  const divisionColors={'TCP':{bg:'#EDE9FE',text:'#5B21B6',border:'#8B5CF6'},'FE':{bg:'#FCE7F3',text:'#9D174D',border:'#EC4899'}};

  const inputStyle={width:'100%',padding:'16px',background:'#1E293B',border:'2px solid #334155',borderRadius:'12px',color:'#E2E8F0',fontSize:'16px'};
  const labelStyle={fontSize:'15px',fontWeight:'600',color:'#CBD5E1',marginBottom:'10px',display:'block'};

  return(
    <div style={{minHeight:'100vh',background:'#0F172A',color:'#E2E8F0',paddingBottom:'120px'}}>
      <header style={{background:'linear-gradient(90deg,#F97316,#EA580C)',padding:'16px 20px',position:'sticky',top:0,zIndex:100}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
          <div style={{display:'flex',alignItems:'center',gap:'10px'}}>
            <div style={{width:'40px',height:'40px',background:'rgba(255,255,255,0.2)',borderRadius:'10px',display:'flex',alignItems:'center',justifyContent:'center',color:'white'}}>
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
            <h1 style={{fontSize:'18px',fontWeight:'700',color:'white'}}>ë¶ˆëŸ‰ ê³µì§€ ì‹œìŠ¤í…œ</h1>
          </div>
          <div style={{fontSize:'13px',color:'rgba(255,255,255,0.9)'}}>{new Date().toLocaleDateString('ko-KR',{month:'long',day:'numeric',weekday:'short'})}</div>
        </div>
      </header>

      <nav style={{display:'flex',gap:'6px',padding:'12px 16px',background:'#1E293B',borderBottom:'1px solid #334155',justifyContent:'center',position:'sticky',top:'72px',zIndex:99}}>
        {[{id:'input',label:'ë“±ë¡'},{id:'list',label:'ëª©ë¡'},{id:'settings',label:'ì„¤ì •'}].map(tab=>(
          <button key={tab.id} onClick={()=>setActiveTab(tab.id)} style={{padding:'14px 28px',background:activeTab===tab.id?'rgba(249,115,22,0.15)':'transparent',border:activeTab===tab.id?'2px solid #F97316':'2px solid transparent',borderRadius:'12px',color:activeTab===tab.id?'#F97316':'#94A3B8',fontSize:'15px',fontWeight:'600',cursor:'pointer'}}>{tab.label}</button>
        ))}
      </nav>

      <main style={{padding:'20px 16px'}}>
        {activeTab==='input'&&(
          <div style={{display:'flex',flexDirection:'column',gap:'24px'}}>
            
            <div>
              <label style={labelStyle}>êµ¬ë¶„ *</label>
              <div style={{display:'flex',gap:'12px'}}>
                {['TCP','FE'].map(d=><button key={d} onClick={()=>handleInputChange('division',d)} style={{flex:1,padding:'18px',background:formData.division===d?divisionColors[d].bg:'#1E293B',border:'2px solid '+(formData.division===d?divisionColors[d].border:'#334155'),borderRadius:'12px',color:formData.division===d?divisionColors[d].text:'#94A3B8',fontSize:'18px',fontWeight:'700',cursor:'pointer'}}>{d}</button>)}
              </div>
            </div>

            <div>
              <label style={labelStyle}>ìœ í˜• *</label>
              <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
                {['ì„¤ë¹„','ë‹¨í’ˆí’ˆì§ˆ','ìì¬'].map(t=><button key={t} onClick={()=>handleInputChange('type',t)} style={{width:'100%',padding:'16px',background:formData.type===t?typeColors[t].bg:'#1E293B',border:'2px solid '+(formData.type===t?typeColors[t].border:'#334155'),borderRadius:'12px',color:formData.type===t?typeColors[t].text:'#94A3B8',fontSize:'16px',fontWeight:'600',cursor:'pointer',textAlign:'center'}}>{t}</button>)}
              </div>
            </div>

            <div>
              <label style={labelStyle}>ë³´ê³ ì * <span style={{fontSize:'13px',color:'#64748B'}}>(í•œê¸€ 4ì)</span></label>
              <input type="text" value={formData.reporter} onChange={e=>handleReporterChange(e.target.value)} placeholder="ì´ë¦„ ì…ë ¥" style={inputStyle}/>
            </div>

            <div>
              <label style={labelStyle}>ì œëª© *</label>
              <input type="text" value={formData.title} onChange={e=>handleInputChange('title',e.target.value)} placeholder="ë©”ì¼ ì œëª©ì— ë“¤ì–´ê°ˆ ë‚´ìš©" style={inputStyle}/>
            </div>

            <div>
              <label style={labelStyle}>ë‚ ì§œ *</label>
              <input type="date" value={formData.date} onChange={e=>handleInputChange('date',e.target.value)} style={inputStyle}/>
            </div>

            <div>
              <label style={labelStyle}>ê·¼ë¬´ì¡°</label>
              <div style={{display:'flex',gap:'12px'}}>
                {['ì£¼ê°„','ì•¼ê°„'].map(sh=><button key={sh} onClick={()=>handleInputChange('shift',sh)} style={{flex:1,padding:'16px',background:formData.shift===sh?'rgba(249,115,22,0.15)':'#1E293B',border:'2px solid '+(formData.shift===sh?'#F97316':'#334155'),borderRadius:'12px',color:formData.shift===sh?'#F97316':'#94A3B8',fontSize:'16px',fontWeight:'600',cursor:'pointer'}}>{sh==='ì£¼ê°„'?'â˜€ï¸ ì£¼ê°„':'ğŸŒ™ ì•¼ê°„'}</button>)}
              </div>
            </div>

            <div>
              <label style={labelStyle}>ë¼ì¸ * {formData.division&&<span style={{fontSize:'13px',color:'#64748B'}}>({formData.division})</span>}</label>
              <select value={formData.line} onChange={e=>handleInputChange('line',e.target.value)} disabled={!formData.division} style={{...inputStyle,cursor:'pointer'}}>
                <option value="">{formData.division?'ì„ íƒí•˜ì„¸ìš”':'êµ¬ë¶„ì„ ë¨¼ì € ì„ íƒ'}</option>
                {getCurrentLines().map(l=><option key={l} value={l}>{l}</option>)}
              </select>
            </div>

            <div>
              <label style={labelStyle}>ê³µì • *</label>
              <input type="text" value={formData.process} onChange={e=>handleInputChange('process',e.target.value)} placeholder="ê³µì •ëª… ì…ë ¥" style={inputStyle}/>
            </div>

            <div>
              <label style={labelStyle}>ì œí’ˆëª… *</label>
              <input type="text" value={formData.productName} onChange={e=>handleInputChange('productName',e.target.value)} placeholder="ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style={inputStyle}/>
            </div>

            <div>
              <label style={labelStyle}>Down Time</label>
              <div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
                <div>
                  <span style={{fontSize:'13px',color:'#64748B',marginBottom:'6px',display:'block'}}>ì‹œì‘</span>
                  <input type="time" value={formData.startTime} onChange={e=>handleInputChange('startTime',e.target.value)} style={inputStyle}/>
                </div>
                <div>
                  <span style={{fontSize:'13px',color:'#64748B',marginBottom:'6px',display:'block'}}>ì¢…ë£Œ</span>
                  <input type="time" value={formData.endTime} onChange={e=>handleInputChange('endTime',e.target.value)} style={inputStyle}/>
                </div>
              </div>
            </div>

            <div>
              <label style={labelStyle}>ë¬¸ì œì  (ì›ì¸)</label>
              <textarea value={formData.problem} onChange={e=>handleInputChange('problem',e.target.value)} placeholder="ë¬¸ì œì  ë° ì›ì¸ì„ ì…ë ¥í•˜ì„¸ìš”" rows={4} style={{...inputStyle,resize:'vertical',fontFamily:'inherit'}}/>
            </div>

            <div>
              <label style={labelStyle}>ì¡°ì¹˜ì‚¬í•­</label>
              <textarea value={formData.action} onChange={e=>handleInputChange('action',e.target.value)} placeholder="ì¡°ì¹˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows={4} style={{...inputStyle,resize:'vertical',fontFamily:'inherit'}}/>
            </div>

            <div>
              <label style={labelStyle}>ê¸°íƒ€</label>
              <textarea value={formData.note} onChange={e=>handleInputChange('note',e.target.value)} placeholder="ê¸°íƒ€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows={3} style={{...inputStyle,resize:'vertical',fontFamily:'inherit'}}/>
            </div>

            <div>
              <label style={labelStyle}>ì‚¬ì§„ ì²¨ë¶€</label>
              <input type="file" ref={fileInputRef} onChange={handlePhotoUpload} accept="image/*" multiple style={{display:'none'}}/>
              <button onClick={()=>fileInputRef.current?.click()} style={{width:'100%',display:'flex',alignItems:'center',justifyContent:'center',gap:'12px',padding:'24px',background:'#1E293B',border:'2px dashed #475569',borderRadius:'12px',color:'#94A3B8',fontSize:'16px',cursor:'pointer'}}>ğŸ“· ì‚¬ì§„ ì¶”ê°€í•˜ê¸°</button>
              {formData.photos.length>0&&<div style={{display:'grid',gridTemplateColumns:'repeat(3,1fr)',gap:'12px',marginTop:'16px'}}>
                {formData.photos.map(p=><div key={p.id} style={{position:'relative',aspectRatio:'1',borderRadius:'12px',overflow:'hidden',border:'2px solid #334155'}}>
                  <img src={p.data} style={{width:'100%',height:'100%',objectFit:'cover'}}/>
                  <button onClick={()=>removePhoto(p.id)} style={{position:'absolute',top:'8px',right:'8px',width:'32px',height:'32px',background:'rgba(239,68,68,0.9)',border:'none',borderRadius:'50%',color:'white',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'20px'}}>x</button>
                </div>)}
              </div>}
            </div>

            <div>
              <label style={labelStyle}>ì¬ë°œì—¬ë¶€</label>
              <div style={{display:'flex',gap:'12px',marginBottom:'12px'}}>
                {['ìµœì´ˆ','ì¬ë°œ'].map(r=><button key={r} onClick={()=>handleInputChange('recurrence',r)} style={{flex:1,padding:'16px',background:formData.recurrence===r?(r==='ì¬ë°œ'?'rgba(239,68,68,0.15)':'rgba(34,197,94,0.15)'):'#1E293B',border:'2px solid '+(formData.recurrence===r?(r==='ì¬ë°œ'?'#EF4444':'#22C55E'):'#334155'),borderRadius:'12px',color:formData.recurrence===r?(r==='ì¬ë°œ'?'#EF4444':'#22C55E'):'#94A3B8',fontSize:'16px',fontWeight:'600',cursor:'pointer'}}>{r}</button>)}
              </div>
              <input type="text" value={formData.recurrenceNote} onChange={e=>handleInputChange('recurrenceNote',e.target.value)} placeholder="ì¶”ê°€ ë‚´ìš© (ì„ íƒ)" style={inputStyle}/>
            </div>

            <button onClick={handlePreviewClick} style={{display:'flex',alignItems:'center',justifyContent:'center',gap:'10px',padding:'20px',background:'linear-gradient(90deg,#3B82F6,#2563EB)',border:'none',borderRadius:'14px',color:'white',fontSize:'18px',fontWeight:'700',cursor:'pointer',marginTop:'16px'}}>ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
          </div>
        )}

        {activeTab==='list'&&(
          <div style={{display:'flex',flexDirection:'column',gap:'16px'}}>
            {records.length===0?<div style={{textAlign:'center',padding:'60px 20px',color:'#64748B'}}><div style={{fontSize:'48px',marginBottom:'16px'}}>ğŸ“‹</div><p>ë“±ë¡ëœ ë¶ˆëŸ‰ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>:
              records.map(r=><div key={r.id} style={{background:'#1E293B',borderRadius:'16px',border:'1px solid #334155',overflow:'hidden'}}>
                <div style={{display:'flex',alignItems:'center',gap:'8px',padding:'14px 16px',background:'#0F172A',borderBottom:'1px solid #334155',flexWrap:'wrap'}}>
                  {r.division&&<span style={{padding:'6px 12px',borderRadius:'8px',fontSize:'13px',fontWeight:'700',background:divisionColors[r.division]?.bg,color:divisionColors[r.division]?.text}}>{r.division}</span>}
                  <span style={{padding:'6px 12px',borderRadius:'8px',fontSize:'13px',fontWeight:'700',background:typeColors[r.type]?.bg,color:typeColors[r.type]?.text}}>{r.type}</span>
                  <span style={{padding:'6px 10px',borderRadius:'8px',fontSize:'12px',fontWeight:'600',background:r.recurrence==='ì¬ë°œ'?'rgba(239,68,68,0.15)':'rgba(34,197,94,0.15)',color:r.recurrence==='ì¬ë°œ'?'#EF4444':'#22C55E'}}>{r.recurrence}</span>
                  <button onClick={()=>deleteRecord(r.id)} style={{marginLeft:'auto',padding:'8px 12px',background:'transparent',border:'none',color:'#64748B',cursor:'pointer',fontSize:'18px'}}>x</button>
                </div>
                <div style={{padding:'16px'}}>
                  <h3 style={{fontSize:'17px',fontWeight:'700',color:'#F1F5F9',marginBottom:'8px'}}>{r.title||r.productName}</h3>
                  <div style={{fontSize:'14px',color:'#94A3B8',marginBottom:'10px'}}>{r.reporter&&<span>ë³´ê³ ì: {r.reporter}<br/></span>}{r.date} {r.shift}<br/>{r.line} / {r.process}</div>
                  {r.productName&&<div style={{fontSize:'14px',color:'#CBD5E1',marginBottom:'8px'}}>ì œí’ˆëª…: {r.productName}</div>}
                  {r.startTime&&<div style={{fontSize:'14px',color:'#F97316',fontWeight:'600',marginBottom:'10px'}}>Down: {r.startTime} {r.endTime?'-> '+r.endTime:'(ì§„í–‰ì¤‘)'}</div>}
                  {r.problem&&<div style={{fontSize:'14px',color:'#CBD5E1',marginBottom:'8px'}}>ë¬¸ì œì : {r.problem}</div>}
                  {r.action&&<div style={{fontSize:'14px',color:'#CBD5E1'}}>ì¡°ì¹˜: {r.action}</div>}
                  {r.photos?.length>0&&<div style={{marginTop:'14px',paddingTop:'14px',borderTop:'1px solid #334155'}}><div style={{display:'flex',gap:'8px',flexWrap:'wrap'}}>{r.photos.map(p=><img key={p.id} src={p.data} onClick={()=>setSelectedImage(p.data)} style={{width:'70px',height:'70px',objectFit:'cover',borderRadius:'8px',border:'2px solid #334155',cursor:'pointer'}}/>)}</div></div>}
                </div>
              </div>)
            }
          </div>
        )}

        {activeTab==='settings'&&(
          <div style={{display:'flex',flexDirection:'column',gap:'24px'}}>
            <div style={{background:'#1E293B',borderRadius:'16px',padding:'20px',border:'1px solid #334155'}}>
              <h2 style={{fontSize:'17px',fontWeight:'700',color:'#F1F5F9',marginBottom:'20px'}}>ğŸ“§ ë©”ì¼ ë°œì†¡ ì„¤ì •</h2>
              <div style={{marginBottom:'20px'}}>
                <div style={{fontSize:'14px',fontWeight:'600',color:'#CBD5E1',marginBottom:'10px'}}><span style={{padding:'4px 10px',borderRadius:'6px',fontSize:'13px',fontWeight:'700',background:divisionColors.TCP.bg,color:divisionColors.TCP.text,marginRight:'8px'}}>TCP</span>ìˆ˜ì‹ ì</div>
                <textarea value={settings.tcpRecipients} onChange={e=>handleSettingsChange('tcpRecipients',e.target.value)} placeholder="ì´ë©”ì¼ ì£¼ì†Œ (ì‰¼í‘œë¡œ êµ¬ë¶„)" rows={3} style={{...inputStyle,fontSize:'14px'}}/>
              </div>
              <div>
                <div style={{fontSize:'14px',fontWeight:'600',color:'#CBD5E1',marginBottom:'10px'}}><span style={{padding:'4px 10px',borderRadius:'6px',fontSize:'13px',fontWeight:'700',background:divisionColors.FE.bg,color:divisionColors.FE.text,marginRight:'8px'}}>FE</span>ìˆ˜ì‹ ì</div>
                <textarea value={settings.feRecipients} onChange={e=>handleSettingsChange('feRecipients',e.target.value)} placeholder="ì´ë©”ì¼ ì£¼ì†Œ (ì‰¼í‘œë¡œ êµ¬ë¶„)" rows={3} style={{...inputStyle,fontSize:'14px'}}/>
              </div>
            </div>

            <div style={{background:'#1E293B',borderRadius:'16px',padding:'20px',border:'1px solid #334155'}}>
              <h2 style={{fontSize:'17px',fontWeight:'700',color:'#F1F5F9',marginBottom:'16px'}}><span style={{padding:'4px 10px',borderRadius:'6px',fontSize:'13px',fontWeight:'700',background:divisionColors.TCP.bg,color:divisionColors.TCP.text,marginRight:'8px'}}>TCP</span>ë¼ì¸ ê´€ë¦¬</h2>
              <div style={{display:'flex',gap:'10px',marginBottom:'16px'}}>
                <input type="text" value={newTcpLine} onChange={e=>setNewTcpLine(e.target.value)} placeholder="ìƒˆ ë¼ì¸ ì´ë¦„" style={{...inputStyle,flex:1}}/>
                <button onClick={addTcpLine} style={{padding:'16px 20px',background:'#8B5CF6',border:'none',borderRadius:'12px',color:'white',fontSize:'15px',fontWeight:'600',cursor:'pointer'}}>ì¶”ê°€</button>
              </div>
              <div style={{display:'flex',flexWrap:'wrap',gap:'10px'}}>{settings.tcpLines?.map(l=><div key={l} style={{display:'flex',alignItems:'center',gap:'8px',padding:'12px 14px',background:'#0F172A',borderRadius:'10px',fontSize:'14px',color:'#E2E8F0',border:'1px solid #334155'}}>{l}<button onClick={()=>removeTcpLine(l)} style={{background:'transparent',border:'none',color:'#EF4444',fontSize:'20px',cursor:'pointer',padding:'0 4px'}}>x</button></div>)}</div>
            </div>

            <div style={{background:'#1E293B',borderRadius:'16px',padding:'20px',border:'1px solid #334155'}}>
              <h2 style={{fontSize:'17px',fontWeight:'700',color:'#F1F5F9',marginBottom:'16px'}}><span style={{padding:'4px 10px',borderRadius:'6px',fontSize:'13px',fontWeight:'700',background:divisionColors.FE.bg,color:divisionColors.FE.text,marginRight:'8px'}}>FE</span>ë¼ì¸ ê´€ë¦¬</h2>
              <div style={{display:'flex',gap:'10px',marginBottom:'16px'}}>
                <input type="text" value={newFeLine} onChange={e=>setNewFeLine(e.target.value)} placeholder="ìƒˆ ë¼ì¸ ì´ë¦„" style={{...inputStyle,flex:1}}/>
                <button onClick={addFeLine} style={{padding:'16px 20px',background:'#EC4899',border:'none',borderRadius:'12px',color:'white',fontSize:'15px',fontWeight:'600',cursor:'pointer'}}>ì¶”ê°€</button>
              </div>
              <div style={{display:'flex',flexWrap:'wrap',gap:'10px'}}>{settings.feLines?.map(l=><div key={l} style={{display:'flex',alignItems:'center',gap:'8px',padding:'12px 14px',background:'#0F172A',borderRadius:'10px',fontSize:'14px',color:'#E2E8F0',border:'1px solid #334155'}}>{l}<button onClick={()=>removeFeLine(l)} style={{background:'transparent',border:'none',color:'#EF4444',fontSize:'20px',cursor:'pointer',padding:'0 4px'}}>x</button></div>)}</div>
            </div>
          </div>
        )}
      </main>

      {showPreviewModal&&(
        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.9)',display:'flex',alignItems:'flex-end',justifyContent:'center',zIndex:1000}}>
          <div style={{background:'#1E293B',borderRadius:'20px 20px 0 0',width:'100%',maxHeight:'90vh',overflow:'hidden',display:'flex',flexDirection:'column'}}>
            <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'18px 20px',borderBottom:'1px solid #334155',background:'#0F172A'}}>
              <h3 style={{fontSize:'17px',fontWeight:'700',color:'#F1F5F9'}}>ğŸ“§ ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°</h3>
              <button onClick={()=>setShowPreviewModal(false)} style={{background:'transparent',border:'none',color:'#64748B',cursor:'pointer',fontSize:'24px',padding:'4px'}}>x</button>
            </div>
            <div style={{padding:'20px',overflowY:'auto',flex:1}}>
              <div style={{background:'#0F172A',borderRadius:'10px',padding:'14px',marginBottom:'14px'}}>
                <span style={{fontSize:'13px',color:'#64748B'}}>ìˆ˜ì‹ ì: </span>
                <span style={{fontSize:'13px',color:'#E2E8F0'}}>{formData.division==='TCP'?settings.tcpRecipients||'(ì„¤ì • í•„ìš”)':settings.feRecipients||'(ì„¤ì • í•„ìš”)'}</span>
              </div>
              <div style={{background:'#0F172A',borderRadius:'12px',padding:'14px',marginBottom:'16px',border:'1px solid #334155'}}>
                <div style={{fontSize:'12px',color:'#64748B',marginBottom:'6px'}}>ì œëª©</div>
                <div style={{fontSize:'15px',color:'#F97316',fontWeight:'600'}}>{getEmailSubject()}</div>
              </div>
              <div style={{background:'#0F172A',borderRadius:'12px',padding:'16px',border:'1px solid #334155',fontSize:'14px'}}>
                {[['1','ë³´ê³ ì',formData.reporter],['2','ìœ í˜•',formData.type],['3','ë‚ ì§œ',formData.date+' '+formData.shift],['4','ë¼ì¸/ê³µì •',formData.line+' / '+formData.process],['5','ì œí’ˆëª…',formData.productName],['6','Down Time',getDownTimeText()],['7','ë¬¸ì œì ',formData.problem||'-'],['8','ì¡°ì¹˜ì‚¬í•­',formData.action||'-'],['9','ê¸°íƒ€',formData.note||'-'],['10','ì¬ë°œì—¬ë¶€',getRecurrenceText()]].map(function(item){return(
                  <div key={item[0]} style={{marginBottom:'12px'}}><span style={{color:'#F97316',fontWeight:'700'}}>{item[0]}.</span> <span style={{color:'#94A3B8'}}>{item[1]}:</span> <span style={{color:'#E2E8F0'}}>{item[2]}</span></div>
                )})}
                <div style={{marginBottom:'8px'}}><span style={{color:'#F97316',fontWeight:'700'}}>11.</span> <span style={{color:'#94A3B8'}}>ê´€ë ¨ ì‚¬ì§„</span></div>
                {formData.photos.length>0?<div style={{display:'flex',gap:'8px',flexWrap:'wrap'}}>{formData.photos.map(p=><img key={p.id} src={p.data} style={{width:'60px',height:'60px',objectFit:'cover',borderRadius:'8px',border:'2px solid #334155'}}/>)}</div>:<div style={{fontSize:'13px',color:'#64748B'}}>ì²¨ë¶€ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
              </div>
            </div>
            <div style={{display:'flex',gap:'12px',padding:'16px 20px',borderTop:'1px solid #334155',background:'#0F172A'}}>
              <button onClick={()=>setShowPreviewModal(false)} disabled={isSending} style={{flex:1,padding:'18px',background:'#334155',border:'none',borderRadius:'12px',color:'#E2E8F0',fontSize:'16px',fontWeight:'600',cursor:'pointer'}}>ì·¨ì†Œ</button>
              <button onClick={handleConfirmSend} disabled={isSending} style={{flex:1,padding:'18px',background:isSending?'#666':'linear-gradient(90deg,#F97316,#EA580C)',border:'none',borderRadius:'12px',color:'white',fontSize:'16px',fontWeight:'600',cursor:isSending?'not-allowed':'pointer'}}>{isSending?'ë°œì†¡ ì¤‘...':'ë°œì†¡'}</button>
            </div>
          </div>
        </div>
      )}

      {selectedImage&&(
        <div onClick={()=>setSelectedImage(null)} style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.95)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1001,padding:'20px'}}>
          <img src={selectedImage} style={{maxWidth:'100%',maxHeight:'85vh',objectFit:'contain',borderRadius:'8px'}}/>
        </div>
      )}
    </div>
  );
};

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
